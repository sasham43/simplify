/*! simplify 2017-12-09 */
angular.module("simplifyApp",["ngRoute","ngAnimate"]);var socket=io();angular.module("simplifyApp").config(["$routeProvider","$locationProvider",function(a,b){a.when("/",{templateUrl:"/views/splash.html",controller:"SplashController",controllerAs:"sc"}).when("/login",{templateUrl:"/views/login.html",controller:"LoginController",controllerAs:"lc"}).when("/albums",{templateUrl:"/views/albums.html",controller:"AlbumsController",controllerAs:"ac"}).when("/album",{templateUrl:"/views/album.html",controller:"ExamineController",controllerAs:"ec"}),b.html5Mode(!0)}]),angular.module("simplifyApp").service("DeviceService",function(){return{device_id:null}}),angular.module("simplifyApp").controller("IndexController",["$http","$location","$rootScope","DeviceService",function(a,b,c,d){var e=this;e.load_spotify=!0,window.onSpotifyPlayerAPIReady=function(){a.get("/spotify/info").then(function(a){console.log("spotify info:",a);const b=a.data.token,c=new Spotify.Player({name:"simplify",getOAuthToken:function(a){a(b)}});c.on("initialization_error",function(a){console.error("Failed to initialize",a.message)}),c.on("authentication_error",function(a){console.error("Failed to authenticate",a.message)}),c.on("account_error",function(a){console.error("Failed to validate Spotify account",a.message)}),c.on("playback_error",function(a){console.error("Failed to perform playback",a.message)}),c.on("ready",function(a){console.log("ready with device id:",a),d.device_id=a.device_id,socket.emit("device",a)}),c.togglePlay(),c.connect().then(function(a){console.log("success:",a)})["catch"](function(a){console.log("no success:",a)})})},e.checkLocation=function(){"/"==b.url()?e.showNav=!1:e.showNav=!0},e.checkLocation()}]),angular.module("simplifyApp").controller("SplashController",["$http","$location",function(a,b){console.log("Splash controller loaded.",b.url())}]),angular.module("simplifyApp").controller("AlbumsController",["UserTrackFactory","AlbumFactory","$location",function(a,b,c){var d=this;d.user={},d.albums=b.albums,a.getUserInfo().then(function(a){d.user=a.data}),d.getAlbums=function(){d.spinning=!0,b.getAlbums(d.stopSpin)},d.stopSpin=function(){d.spinning=!1},d.updateAlbums=function(){d.spinning=!0,b.updateAlbums(d.stopSpin)},d.examineAlbum=function(a){socket.emit("examine album",{album:a}),b.examineAlbum(a)},d.getAlbums(d.stopSpin),console.log("albums controller loaded.")}]),angular.module("simplifyApp").controller("ExamineController",["AlbumFactory","UserTrackFactory","DeviceService","$http","$scope",function(a,b,c,d,e){var f=this;f.trackCount=0,f.currentlyPlaying=!1,f.coverView=!1,socket.on("socket connected",function(a){console.log("socket connected")}),socket.on("disconnect",function(a){console.log("socket disconnected, attempting reconnect..."),socket.connect()}),socket.on("status",function(a){if(a.examineAlbum.album_id==a.album.album_id){switch(a.status){case"track playing":e.$apply(function(){f.currentlyPlaying=!0});break;case"track paused":e.$apply(function(){f.currentlyPlaying=!1})}e.$apply(function(){f.currentAlbum=a.examineAlbum,f.trackCount=a.track.track_number})}else e.$apply(function(){f.trackCount=0,f.currentlyPlaying=!1,f.currentAlbum=a.examineAlbum});console.log("status: ",a,f.currentAlbum)}),socket.emit("get status"),f.playTrack=function(a){console.log("device:",c),socket.emit("command",{cmd:"play",album:f.currentAlbum,trackNumber:a,device:c.device_id})},f.pauseTrack=function(){socket.emit("command",{cmd:"pause"})},f.playPauseTrack=function(a){f.currentlyPlaying?f.pauseTrack():f.playTrack(a)},f.prevTrack=function(){f.trackCount--,socket.emit("command",{cmd:"prev"})},f.nextTrack=function(){f.trackCount++,socket.emit("command",{cmd:"next"})},f.trackMarker=function(a){return a==f.trackCount},f.switchView=function(){f.coverView=!f.coverView}}]),angular.module("simplifyApp").factory("AlbumFactory",["$http","$location",function(a,b){var c=[],d={album:{}},e=function(b){a.get("/spotify/albums/stored").then(function(a){console.log("Stored album response:",a.data,b),angular.copy(a.data.storedAlbums,c),b()})},f=function(b){a.get("/spotify/albums/update").then(function(a){console.log("Album response:",a.data,b),e(b)})},g=function(a){b.url("/album"),console.log("examining album:",a)};return{currentAlbum:d,examineAlbum:g,updateAlbums:f,albums:c,getAlbums:e}}]),angular.module("simplifyApp").factory("UserTrackFactory",["$http",function(a){var b={},c=function(){return console.log("here"),a.get("/authorize/info")};return{user:b,getUserInfo:c}}]);