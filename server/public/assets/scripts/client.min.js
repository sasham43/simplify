/*! simplify 2017-12-04 */
angular.module("simplifyApp",["ngRoute","ngAnimate"]);var socket=io();angular.module("simplifyApp").config(["$routeProvider","$locationProvider",function(a,b){a.when("/",{templateUrl:"/views/splash.html",controller:"SplashController",controllerAs:"sc"}).when("/login",{templateUrl:"/views/login.html",controller:"LoginController",controllerAs:"lc"}).when("/albums",{templateUrl:"/views/albums.html",controller:"AlbumsController",controllerAs:"ac"}).when("/album",{templateUrl:"/views/album.html",controller:"ExamineController",controllerAs:"ec"}),b.html5Mode(!0)}]),angular.module("simplifyApp").controller("IndexController",["$http","$location",function(a,b){var c=this;window.onSpotifyPlayerAPIReady=function(){a.get("/spotify/info").then(function(a){console.log("spotify info:",a);const b=a.data.token,c=new Spotify.Player({name:"simplify",getOAuthToken:function(a){a(b)}});c.on("ready",function(a){console.log("ready with device id:",a)}),c.togglePlay(),c.connect()})},c.checkLocation=function(){"/"==b.url()?c.showNav=!1:c.showNav=!0},c.checkLocation()}]),angular.module("simplifyApp").controller("SplashController",["$http","$location",function(a,b){console.log("Splash controller loaded.",b.url())}]),angular.module("simplifyApp").controller("AlbumsController",["UserTrackFactory","AlbumFactory","$location",function(a,b,c){var d=this;d.user={},d.albums=b.albums,a.getUserInfo().then(function(a){d.user=a.data}),d.getAlbums=function(){d.spinning=!0,b.getAlbums(d.stopSpin)},d.stopSpin=function(){d.spinning=!1},d.updateAlbums=function(){d.spinning=!0,b.updateAlbums(d.stopSpin)},d.examineAlbum=function(a){socket.emit("examine album",{album:a}),b.examineAlbum(a)},d.getAlbums(d.stopSpin),console.log("albums controller loaded.")}]),angular.module("simplifyApp").controller("ExamineController",["AlbumFactory","UserTrackFactory","$http","$scope",function(a,b,c,d){var e=this;e.trackCount=0,e.currentlyPlaying=!1,e.coverView=!1,socket.on("socket connected",function(a){console.log("socket connected")}),socket.on("disconnect",function(a){console.log("socket disconnected, attempting reconnect..."),socket.connect()}),socket.on("status",function(a){if(a.examineAlbum.album_id==a.album.album_id){switch(a.status){case"track playing":d.$apply(function(){e.currentlyPlaying=!0});break;case"track paused":d.$apply(function(){e.currentlyPlaying=!1})}d.$apply(function(){e.currentAlbum=a.examineAlbum,e.trackCount=a.track.track_number})}else d.$apply(function(){e.trackCount=0,e.currentlyPlaying=!1,e.currentAlbum=a.examineAlbum});console.log("status: ",a,e.currentAlbum)}),socket.emit("get status"),e.playTrack=function(a){socket.emit("command",{cmd:"play",album:e.currentAlbum,trackNumber:a})},e.pauseTrack=function(){socket.emit("command",{cmd:"pause"})},e.playPauseTrack=function(a){e.currentlyPlaying?e.pauseTrack():e.playTrack(a)},e.prevTrack=function(){e.trackCount--,socket.emit("command",{cmd:"prev"})},e.nextTrack=function(){e.trackCount++,socket.emit("command",{cmd:"next"})},e.trackMarker=function(a){return a==e.trackCount},e.switchView=function(){e.coverView=!e.coverView}}]),angular.module("simplifyApp").factory("AlbumFactory",["$http","$location",function(a,b){var c=[],d={album:{}},e=function(b){a.get("/spotify/albums/stored").then(function(a){console.log("Stored album response:",a.data,b),angular.copy(a.data.storedAlbums,c),b()})},f=function(b){a.get("/spotify/albums/update").then(function(a){console.log("Album response:",a.data,b),e(b)})},g=function(a){b.url("/album"),console.log("examining album:",a)};return{currentAlbum:d,examineAlbum:g,updateAlbums:f,albums:c,getAlbums:e}}]),angular.module("simplifyApp").factory("UserTrackFactory",["$http",function(a){var b={},c=function(){return console.log("here"),a.get("/authorize/info")};return{user:b,getUserInfo:c}}]);