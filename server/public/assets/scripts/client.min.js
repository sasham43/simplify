/*! simplify 2016-07-27 */
angular.module("simplifyApp",["ngRoute"]);var socket=io();angular.module("simplifyApp").config(["$routeProvider","$locationProvider",function(a,b){a.when("/",{templateUrl:"/views/splash.html",controller:"SplashController",controllerAs:"sc"}).when("/login",{templateUrl:"/views/login.html",controller:"LoginController",controllerAs:"lc"}).when("/albums",{templateUrl:"/views/albums.html",controller:"AlbumsController",controllerAs:"ac"}).when("/album",{templateUrl:"/views/album.html",controller:"ExamineController",controllerAs:"ec"}),b.html5Mode(!0)}]),angular.module("simplifyApp").controller("IndexController",["$http","$location",function(a,b){var c=this;c.checkLocation=function(){"/"==b.url()?c.showNav=!1:c.showNav=!0},c.checkLocation()}]),angular.module("simplifyApp").controller("SplashController",["$http","$location",function(a,b){console.log("Splash controller loaded.",b.url())}]),angular.module("simplifyApp").controller("AlbumsController",["UserTrackFactory","AlbumFactory","$location",function(a,b,c){var d=this;d.user={},d.albums=b.albums,a.getUserInfo().then(function(a){d.user=a.data}),d.getAlbums=function(){d.spinning=!0,b.getAlbums(d.stopSpin)},d.stopSpin=function(){d.spinning=!1,c.hash("album79"),console.log("spin spotted")},d.updateAlbums=function(){d.spinning=!0,b.updateAlbums(d.stopSpin)},d.showAlbumOverlay=function(a){a.show=!0},d.hideAlbumOverlay=function(a){a.show=!1},d.examineAlbum=function(a){socket.emit("examine album",{album:a}),b.examineAlbum(a)},d.getAlbums(d.stopSpin),console.log("albums controller loaded.")}]),angular.module("simplifyApp").controller("ExamineController",["AlbumFactory","$scope",function(a,b){var c=this;c.trackCount=0,c.currentlyPlaying=!1,socket.on("socket connected",function(a){console.log("socket connected")}),socket.emit("get album"),socket.on("examining album",function(a){b.$apply(function(){c.currentAlbum=a.album}),console.log("examining album",c.currentAlbum)}),socket.on("track playing",function(a){console.log("playing track:",a.name),b.$apply(function(){c.currentlyPlaying=!0}),console.log("ec.currentlyPlaying",c.currentlyPlaying)}),socket.on("track paused",function(a){b.$apply(function(){c.currentlyPlaying=!1}),console.log("track paused",c.currentlyPlaying)}),socket.on("track finished",function(a){console.log("track finished"),b.$apply(function(){c.trackCount++}),c.trackCount<=c.currentAlbum.tracks.length-1?c.playTrack(c.trackCount):socket.emit("stop track")}),c.playTrack=function(a){socket.emit("play track",{album:c.currentAlbum,trackNumber:a}),c.trackCount=a},c.pauseTrack=function(){socket.emit("pause track")},c.playPauseTrack=function(a){c.currentlyPlaying?c.pauseTrack():c.playTrack(a)},c.prevTrack=function(){c.trackCount--,c.playTrack(c.trackCount)},c.nextTrack=function(){c.trackCount++,c.playTrack(c.trackCount)},c.trackMarker=function(a){return a==c.trackCount}}]),angular.module("simplifyApp").factory("AlbumFactory",["$http","$location",function(a,b){var c=[],d={album:{}},e=function(b){a.get("/spotify/albums/stored").then(function(a){console.log("Stored album response:",a.data,b),angular.copy(a.data.storedAlbums,c),b()})},f=function(b){a.get("/spotify/albums/update").then(function(a){console.log("Album response:",a.data,b),e(b)})},g=function(a){b.url("/album"),d.album=a,console.log("examining album:",a)},h=function(b){var c=0,d=function(){a.post("/play/track/",b.tracks[c]).then(function(a){console.log("track ended?",a.data),"track playing"===a.data.message?console.log("playing:",b.tracks[c].track_name):"track finished"===a.data.message&&(console.log("track ended."),d())})};d()},i=function(b){a.get("/play/track/"+b.track_link).then(function(a){})};return{currentAlbum:d,examineAlbum:g,updateAlbums:f,albums:c,getAlbums:e,playAlbum:h,playTrack:i}}]),angular.module("simplifyApp").factory("UserTrackFactory",["$http",function(a){var b={},c=function(){return a.get("/authorize/info")};return{user:b,getUserInfo:c}}]);